
<%=form_tag(:controller => "profiles", :action => "create", :method => "post")%>
<%= select_tag "custom_objects", options_for_select(@custom_objects.sort! { |a,b| a <=> b }) %>
<%= observe_field :custom_objects, :url => {:action => 'update_check_boxes'}, :method => :post, :with => 'value' %>
<br><br>
<div width="900px">
	<table width="900px" border="1" cellpadding="2" cellspacing="2" style="border-collapse: collapse;">
		<tr>
			<td align="center">Read</td>
			<td align="center">Edit</td>
			<td align="center">Create</td>
			<td align="center">Delete</td>
			<td align="center">View All</td>
			<td align="center">Modify All</td>
			<td width="50%"></td>
		</tr>
		<%@files.each do |file_path|%>
		<%file_name = File.basename(file_path, ".profile")%>
		<%file = File.open(file_path, 'r')%>
		<%file_contents = file.read%>
		<%file.close%>
		<%doc = Nokogiri::XML(file_contents)%>
		<%
		doc.remove_namespaces!
		#namespaces = doc.namespaces
		%>
		<tr>
			<td align="center">
				<%if doc.xpath("//Profile/objectPermissions/allowRead").text == 'true'%>
					<%=check_box("read", file_name, {:checked => 'checked'}, "yes", "no")%>
				<%else%>
					<%=check_box("read", file_name, {}, "yes", "no")%>
				<%end%>
			</td>
			<td align="center">
				<%if doc.xpath("//Profile/objectPermissions/allowEdit").text == 'true'%>
					<%=check_box("edit", file_name, {:checked => 'checked'}, "yes", "no")%>
				<%else%>
					<%=check_box("edit", file_name, {}, "yes", "no")%>
				<%end%>
			</td>
			<td align="center">
				<%if doc.xpath("//Profile/objectPermissions/allowCreate").text == 'true'%>
					<%=check_box("create", file_name, {:checked => 'checked'}, "yes", "no")%>
				<%else%>
					<%=check_box("create", file_name, {}, "yes", "no")%>
				<%end%>
			</td>
			<td align="center">
				<%if doc.xpath("//Profile/objectPermissions/allowDelete").text == 'true'%>
					<%=check_box("delete", file_name, {:checked => 'checked'}, "yes", "no")%>
				<%else%>
					<%=check_box("delete", file_name, {}, "yes", "no")%>
				<%end%>
			</td>
			<td align="center">
				<%if doc.xpath("//Profile/objectPermissions/viewAllRecords").text == 'true'%>
					<%=check_box("view_all", file_name, {:checked => 'checked'}, "yes", "no")%>
				<%else%>
					<%=check_box("view_all", file_name, {}, "yes", "no")%>
				<%end%>
			</td>
			<td align="center">
				<%if doc.xpath("//Profile/objectPermissions/modifyAllRecords").text == 'true'%>
					<%=check_box("modify_all", file_name, {:checked => 'checked'}, "yes", "no")%>
				<%else%>
					<%=check_box("modify_all", file_name, {}, "yes", "no")%>
				<%end%>				
			</td>
			<td>
				&nbsp;&nbsp;<%=file_name%>
	        </td>
		</tr>
		<%end%>
	</table>
</div>
<%= hidden_field_tag(:values, @profiles) %>
<%= submit_tag "Submit" %>
</form>
